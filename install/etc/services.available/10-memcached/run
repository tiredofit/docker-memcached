#!/usr/bin/with-contenv bash

source /assets/functions/00-container
prepare_service 03-monitoring
PROCESS_NAME="memcached"

check_container_initialized
liftoff

# first arg is `-f` or `--some-option`
if [ "${1#-}" != "$1" ]; then
	set -- memcached "$@"
fi

if var_true "${CONTAINER_ENABLE_MONITORING}" && [ "${CONTAINER_MONITORING_BACKEND,,}" = "zabbix" ]; then
	cat <<EOF > "${ZABBIX_CONFIG_PATH}"/"${ZABBIX_CONFIG_FILE}.d"/tiredofit_memcached.conf
# Zabbix memcached Configuration - Automatically Generated
# Find Companion Zabbix Server Templates at https://github.com/tiredofit/docker-memcached
# Autoregister=memcached
EOF
fi
liftoff

print_start "Starting Memcached ${MEMCACHED_VERSION}"
exec s6-setuidgid memcached memcached
